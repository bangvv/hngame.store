<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HN Game - C√¥ng Th√†nh Chi·∫øn</title>

<meta name="description" content="Game chienthuat C√¥ng Th√†nh Chi·∫øn c·ª±c hay">
<meta name="keywords" content="game C√¥ng Th√†nh Chi·∫øn, chienthuat, game Vi·ªát, HN Game, mi·ªÖn ph√≠, game online, web game">
<meta property="og:title" content="Game chienthuat C√¥ng Th√†nh Chi·∫øn - HN Game">
<meta property="og:description" content="Ch∆°i game C√¥ng Th√†nh Chi·∫øn ho√†n to√†n mi·ªÖn ph√≠, vui nh·ªôn v√† h·∫•p d·∫´n.">
<meta property="og:image" content="../image/congthanh.png">
<meta property="og:url" content="www.hngame.store/game/congthanh/webapp">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Game chienthuat C√¥ng Th√†nh Chi·∫øn">
<meta name="twitter:description" content="Ch∆°i game C√¥ng Th√†nh Chi·∫øn ho√†n to√†n mi·ªÖn ph√≠, vui nh·ªôn v√† h·∫•p d·∫´n.">
<meta name="twitter:image" content="../image/congthanh.png">

<style>
  html, body {background: #0f172a;color: #e2e8f0;font-family: 'Arial', sans-serif;margin: 0;padding: 0;}
  header {text-align: center;padding: 20px;background: #1e293b;color: #fff;}
  nav {background: #334155;display: flex;justify-content: center;flex-wrap: wrap;gap: 15px;padding: 10px 0;}
  nav a {color: #f8fafc;text-decoration: none;padding: 8px 14px;border-radius: 6px;transition: 0.3s;}
  nav a:hover {background: #60a5fa;color: #fff;}
  main {max-width: 1200px;margin: 20px auto;padding: 0 15px;justify-content: center;}
  .fullscreen-button {padding: 10px 20px;margin-top: 8px;font-size: 16px;border: none;border-radius: 8px;cursor: pointer;background: #444;color: #fff;justify-content: center;align-self: center;}
  .fullscreen-button:hover {background: #666;}
  .section {background: #1e293b;border-radius: 10px;padding: 20px;margin-bottom: 20px;}
  .section h2 {color: #60a5fa;margin-top: 0;}
  .game-container {display: flex;flex-direction: column;justify-content: center;background: #1e293b;border-radius: 12px;text-align: center;}
  
  canvas#canvas {
    display: block;
    background: #000;
    border: 2px solid #334155;
    border-radius: 10px;
    width: 486px;  /* 9:16 */
    height: 864px;
    margin: 0 auto;
  }
  @media (max-width: 768px) { 
    .game-container {width: 100%;display: flex;flex-direction: column;align-items: center;justify-content: center;}
    canvas#canvas {
      width: 90%;
      height: calc(90% * 16 / 9);
      border: 2px solid #334155;
      border-radius: 10px;
      background: #000;
    }
  }
  footer {text-align: center;padding: 20px;background: #1e293b;color: #94a3b8;font-size: 14px;}
  * {box-sizing: border-box;max-width: 100vw;}
</style>
</head>

<body oncontextmenu="return false" onload="start()">
<header>
  <h1>HN Game</h1>
  <p>Kho game Vi·ªát ch·∫•t l∆∞·ª£ng - ch∆°i mi·ªÖn ph√≠, gi·∫£i tr√≠ m·ªói ng√†y</p>
</header>

<nav>
  <a href="../../../index.html">Trang ch·ªß</a>
  <a href="../../../chienthuat.html">Game chi·∫øn thu·∫≠t</a>
  <a href="../../../hanhdong.html">Game h√†nh ƒë·ªông</a>
  <a href="../../../tritue.html">Game tr√≠ tu·ªá</a>
  <a href="../../../thethao.html">Game th·ªÉ thao</a>
  <a href="../../../lienhe.html">Li√™n h·ªá</a>
</nav>

<main>
  <section class="section">
    <h2>üéÆ Gi·ªõi thi·ªáu game</h2>
    <p><strong>C√¥ng Th√†nh Chi·∫øn</strong> l√† tr√≤ ch∆°i tr√≠ tu·ªá ƒë·ªânh cao, l·ª±a ch·ªçn c·ªßa b·∫°n quy·∫øt ƒë·ªãnh v·∫≠n m·ªánh c·ªßa b·∫°n, h√£y ch∆°i h·∫øt m√¨nh ƒë·ªÉ ti·∫øn ƒë·∫øn ƒëinh cao.</p>
  </section>

  <section class="game-container">
  <div style="height:20px;"></div>
    <canvas id="canvas" width=1080 height=1920></canvas>
    <div style="height:10px;"></div>
    <button id="fullscreen-btn" class="fullscreen-button">üñ•Ô∏è Full m√†n h√¨nh.</button>
    <div style="height:10px;"></div>
  </section>

  <div style="height:30px;"></div>

  <section class="section">
    <h2>üìú H∆∞·ªõng d·∫´n ch∆°i</h2>
    <ul>
      <li>gh√©p c√°c item v·ªõi nhau ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c gi√° tr·ªã t∆∞∆°ng ·ª©ng.</li>
      <li>Game match-3 huy·ªÅn tho·∫°i.</li>
    </ul>
  </section>
</main>

<footer>
  &copy; 2025 HN Game. T·∫•t c·∫£ b·∫£n quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.
</footer>

<script type="text/javascript" charset="utf-8" src="teavm/app.js"></script>

<script>
const canvas = document.getElementById("canvas");
const fullBtn = document.getElementById("fullscreen-btn");
const LOGICAL_WIDTH = 1080;
const LOGICAL_HEIGHT = 1920;

function isMobile() {
  return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(navigator.userAgent);
}

function resizeCanvas() {
  const full = !!document.fullscreenElement;
  const mobile = isMobile();
  const dpr = window.devicePixelRatio || 1; // <--- th√™m d√≤ng n√†y

  if (full) {
    if (mobile) {
      const screenRatio = window.innerWidth / window.innerHeight;
      const targetRatio = LOGICAL_WIDTH / LOGICAL_HEIGHT;
      let w, h;

      if (screenRatio > targetRatio) {
        h = window.innerHeight;
        w = h * targetRatio;
      } else {
        w = window.innerWidth;
        h = w / targetRatio;
      }

      // Set style (hi·ªÉn th·ªã)
      canvas.style.width = w + "px";
      canvas.style.height = h + "px";

      // Set ƒë·ªô ph√¢n gi·∫£i th·ª±c (pixel v·∫≠t l√Ω)
      canvas.width = w * dpr;
      canvas.height = h * dpr;

      const ctx = canvas.getContext("2d");
      ctx.scale(dpr, dpr);

      canvas.style.margin = "auto";
      canvas.style.display = "block";
      console.log("resizeCanvas mobile");
    } else {
      // Desktop fullscreen
      canvas.style.width = "100vw";
      canvas.style.height = "100vh";
      canvas.width = window.innerWidth * dpr;
      canvas.height = window.innerHeight * dpr;

      const ctx = canvas.getContext("2d");
      ctx.scale(dpr, dpr);

      console.log("resizeCanvas Desktop");
    }

    document.documentElement.style.overflow = "hidden";
    document.body.style.overflow = "hidden";
    document.body.style.position = "fixed";
    document.body.style.width = "100%";
  } else {
    // B√¨nh th∆∞·ªùng
    document.body.style.position = "";
    document.body.style.width = "";
    const ctx = canvas.getContext("2d");

    if (mobile) {
      const w = window.innerWidth * 0.9;
      const h = w * 16 / 9;
      canvas.style.width = w + "px";
      canvas.style.height = h + "px";
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      ctx.scale(dpr, dpr);
    } else {
      canvas.style.width = "486px";
      canvas.style.height = "864px";
      canvas.width = 486 * dpr;
      canvas.height = 864 * dpr;
      ctx.scale(dpr, dpr);
    }

    document.documentElement.style.overflowX = "hidden";
    document.body.style.overflowX = "hidden";
    document.documentElement.style.overflowY = "auto";
    document.body.style.overflowY = "auto";
  }
}


// // === Resize canvas hi·ªÉn th·ªã ===
// function resizeCanvas() {
//   const full = !!document.fullscreenElement;
//   const mobile = isMobile();

//   if (full) {
//     if (mobile) {
//       // Gi·ªØ ƒë√∫ng t·ª∑ l·ªá 9:16
//       const screenRatio = window.innerWidth / window.innerHeight;
//       const targetRatio = LOGICAL_WIDTH / LOGICAL_HEIGHT;
//       let w, h;

//       if (screenRatio > targetRatio) {
//         // M√†n h√¨nh qu√° r·ªông ‚Üí cƒÉn gi·ªØa theo chi·ªÅu ngang
//         h = window.innerHeight;
//         w = h * targetRatio;
//       } else {
//         // M√†n h√¨nh qu√° cao ‚Üí cƒÉn gi·ªØa theo chi·ªÅu d·ªçc
//         w = window.innerWidth;
//         h = w / targetRatio;
//       }
//       canvas.width = window.innerWidth;
//       canvas.height = window.innerHeight;
//       canvas.style.width = w + "px";
//       canvas.style.height = h + "px";

//       // CƒÉn gi·ªØa canvas
//       canvas.style.margin = "auto";
//       canvas.style.display = "block";
//       console.log("resizeCanvas mobile")
//     } else {
//       // Desktop fullscreen
//       console.log("resizeCanvas Desktop")
//       canvas.width = window.innerWidth;
//       canvas.height = window.innerHeight;
//       canvas.style.width = "100vw";
//       canvas.style.height = "100vh";
//     }

//     document.documentElement.style.overflow = "hidden";
//     document.body.style.overflow = "hidden";
//     document.body.style.position = "fixed";
//     document.body.style.width = "100%";
//   } else {
//     // B√¨nh th∆∞·ªùng
//     document.body.style.position = "";
//     document.body.style.width = "";
//     canvas.width = LOGICAL_WIDTH;
//     canvas.height = LOGICAL_HEIGHT;

//     if (mobile) {
//       canvas.style.width = "90%";
//       canvas.style.height = "calc(90% * 16 / 9)";
//     } else {
//       canvas.style.width = "486px";
//       canvas.style.height = "864px";
//     }

//     document.documentElement.style.overflowX = "hidden";
//     document.body.style.overflowX = "hidden";
//     document.documentElement.style.overflowY = "auto";
//     document.body.style.overflowY = "auto";
//   }
// }

function getCanvasCoords(evt) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;

  let clientX = 0, clientY = 0;
  if (evt.touches && evt.touches.length > 0) {
    clientX = evt.touches[0].clientX;
    clientY = evt.touches[0].clientY;
  } else if (evt.changedTouches && evt.changedTouches.length > 0) {
    clientX = evt.changedTouches[0].clientX;
    clientY = evt.changedTouches[0].clientY;
  } else if (evt.clientX !== undefined && evt.clientY !== undefined) {
    clientX = evt.clientX;
    clientY = evt.clientY;
  }

  // --- FIX L·ªÜCH DO PH·∫¶N ƒêEN TR√äN D∆Ø·ªöI ---
  // Khi fullscreen, n·∫øu canvas kh√¥ng cao b·∫±ng window.innerHeight th√¨ c√≥ vi·ªÅn ƒëen -> ph·∫£i tr·ª´ b√π
  let offsetY = 0;
  if (window.innerHeight > rect.height + 1) {
    offsetY = (window.innerHeight - rect.height) / 2;
  }

  console.log("offsetY:",offsetY)
  console.log("clientX:",(clientX - rect.left) * scaleX)
  console.log("clientY:",(clientY - rect.top - offsetY) * scaleY)

  return {
    x: (clientX - rect.left) * scaleX,
    y: (clientY - rect.top - offsetY) * scaleY,
  };
}

["mousedown", "touchstart"].forEach(ev =>
  canvas.addEventListener(ev, e => {
    e.preventDefault();
    resizeCanvas();
    const p = getCanvasCoords(e);
    console.log("canvas.addEventListener_mousedown_touchstart")
    if (typeof gameTouchStart === "function") gameTouchStart(p.x, p.y);
  })
);
["mouseup", "touchend"].forEach(ev =>
  canvas.addEventListener(ev, e => {
    e.preventDefault();
    if (typeof gameTouchEnd === "function") gameTouchEnd();
  })
);
canvas.addEventListener("touchmove", e => {
  e.preventDefault();
  const p = getCanvasCoords(e);
  console.log("canvas.addEventListener_touchmove")
  if (typeof gameTouchMove === "function") gameTouchMove(p.x, p.y);
});

// === Fullscreen toggle ===
fullBtn.addEventListener("click", async () => {
  try {
    if (canvas.requestFullscreen) {
      await canvas.requestFullscreen();
      console.log("fullBtn.addEventListener ___ 1")
    } else if (canvas.webkitRequestFullscreen) {
      await canvas.webkitRequestFullscreen();
      console.log("fullBtn.addEventListener ___ 2")
    } 
    setTimeout(resizeCanvas, 200);
    console.log("fullBtn.addEventListener")
  } catch (e) {
    console.error("Fullscreen error:", e);
  }
});

// === Event thay ƒë·ªïi k√≠ch th∆∞·ªõc / xoay / fullscreen ===
["resize", "orientationchange", "fullscreenchange"].forEach(ev =>
  window.addEventListener(ev, () => setTimeout(resizeCanvas, 200))
);

// === Kh·ªüi ƒë·ªông TeaVM game ===
function start() {
  resizeCanvas();
  if (typeof main === "function") main();
}
window.addEventListener("load", start);
</script>

</body>
</html>