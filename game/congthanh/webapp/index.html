<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HN Game - Công Thành Chiến</title>

<meta name="description" content="Game chiến thuật Công Thành Chiến cực hay">
<meta name="keywords" content="game Công Thành Chiến, chiến thuật, game Việt, HN Game, miễn phí, game online, web game">
<meta property="og:title" content="Game chiến thuật Công Thành Chiến - HN Game">
<meta property="og:description" content="Chơi game Công Thành Chiến hoàn toàn miễn phí, vui nhộn và hấp dẫn.">
<meta property="og:image" content="../image/congthanh.png">
<meta property="og:url" content="www.hngame.store/game/congthanh/webapp">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Game chiến thuật Công Thành Chiến">
<meta name="twitter:description" content="Chơi game Công Thành Chiến hoàn toàn miễn phí, vui nhộn và hấp dẫn.">
<meta name="twitter:image" content="../image/congthanh.png">

<style>
body {
  background: #0f172a;
  color: #e2e8f0;
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
}

header {
  text-align: center;
  padding: 20px;
  background: #1e293b;
  color: #fff;
}

nav {
  background: #334155;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  padding: 10px 0;
}

nav a {
  color: #f8fafc;
  text-decoration: none;
  padding: 8px 14px;
  border-radius: 6px;
  transition: 0.3s;
}

nav a:hover {
  background: #60a5fa;
  color: #fff;
}

main {
  max-width: 1200px;
  margin: 20px auto;
  padding: 0 15px;
}

.section {
  background: #1e293b;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
}

.section h2 {
  color: #60a5fa;
  margin-top: 0;
}

/* 🎯 Container chính căn giữa tuyệt đối */
.game-container {
  display: flex;
  flex-direction: column;
  /* align-items: center;     /* căn giữa ngang */
  justify-content: center; /* căn giữa dọc */
  background: #1e293b;
  border-radius: 12px;
  text-align: center;
}

/* 🖥️ Canvas mặc định (desktop) */
canvas#canvas {
  display: block;
  background: #000;
  border: 2px solid #334155;
  border-radius: 10px;
  width: 486px;
  height: 864px;
  margin: 0 auto;
}

/* 📱 Mobile giữ đúng tỉ lệ 9:16 và căn giữa */
/* Mobile */ 
@media (max-width: 768px) { 
  .game-container {width: 100%;display: flex;flex-direction: column;align-items: center;justify-content: center;} 
  canvas#canvas {width: 90%; height: calc(90vw * 16 / 9);border: 2px solid #334155;border-radius: 10px;background: #000;} 
}

/* 🖥️ Nút fullscreen căn giữa */
.fullscreen-button {
  margin-top: 15px;
  padding: 10px 20px;
  background: #3b82f6;
  border: none;
  border-radius: 8px;
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.2s;
}

.fullscreen-button:hover {
  background: #2563eb;
}

footer {
  text-align: center;
  padding: 20px;
  background: #1e293b;
  color: #94a3b8;
  font-size: 14px;
}

</style>
</head>

<body oncontextmenu="return false" onload="start()">
<header>
  <h1>HN Game</h1>
  <p>Kho game Việt chất lượng - chơi miễn phí, giải trí mỗi ngày</p>
</header>

<nav>
  <a href="../../../index.html">Trang chủ</a>
  <a href="../../../chienthuat.html">Game chiến thuật</a>
  <a href="../../../hanhdong.html">Game hành động</a>
  <a href="../../../tritue.html">Game trí tuệ</a>
  <a href="../../../thethao.html">Game thể thao</a>
  <a href="../../../lienhe.html">Liên hệ</a>
</nav>

<main>
  <section class="section">
    <h2>🎮 Giới thiệu game</h2>
    <p><strong>Công Thành Chiến</strong> là trò chơi trí tuệ đỉnh cao, lựa chọn của bạn quyết định vận mệnh của bạn, hãy chơi hết mình để tiến đến đinh cao.</p>
  </section>

  <section class="game-container">
    <div style="height:20px;"></div>
    <canvas id="canvas" width="1080" height="1920"></canvas>
    <div style="height:10px;"></div>
    <button id="fullscreen-btn" class="fullscreen-button">🖥️ Full màn hình.</button>
  </section>

  <div style="height:30px;"></div>

  <section class="section">
    <h2>📜 Hướng dẫn chơi</h2>
    <ul>
      <li>ghép các item với nhau để đạt được giá trị tương ứng.</li>
      <li>Game match-3 huyền thoại.</li>
    </ul>
  </section>
</main>

<footer>
  &copy; 2025 HN Game. Tất cả bản quyền được bảo lưu.
</footer>

<script type="text/javascript" charset="utf-8" src="teavm/app.js"></script>

<script>
/* ---------- CẤU HÌNH LOGIC GAME (KHÔNG đổi) ---------- */
const LOGICAL_WIDTH = 1080;
const LOGICAL_HEIGHT = 1920;

const canvas = document.getElementById("canvas");
const fullBtn = document.getElementById("fullscreen-btn");

/* Đảm bảo canvas internal resolution là logic game */
function enforceLogicalCanvasSize() {
  // Nếu TeaVM/1 thư viện nào đó đã thay canvas.width, ta override lại
  if (canvas.width !== LOGICAL_WIDTH) canvas.width = LOGICAL_WIDTH;
  if (canvas.height !== LOGICAL_HEIGHT) canvas.height = LOGICAL_HEIGHT;
}

/* phát hiện mobile */
function isMobile() {
  return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(navigator.userAgent);
}

/* Set CSS hiển thị khi fullscreen / không fullscreen */
function applyDisplaySizeForState() {
  const full = !!document.fullscreenElement;
  const mobile = isMobile();

  if (full) {
    // Fullscreen: dùng visualViewport khi có (để tránh thanh address bar on mobile)
    if (mobile && window.visualViewport) {
      const vw = window.visualViewport.width;
      const vh = window.visualViewport.height;
      // use fixed so it overlays page cleanly
      canvas.style.position = "fixed";
      canvas.style.left = "0";
      canvas.style.top = "0";
      canvas.style.width = vw + "px";
      canvas.style.height = vh + "px";
      canvas.style.maxWidth = "none";
      canvas.style.maxHeight = "none";
      canvas.style.margin = "0";
    } else {
      // Desktop or no visualViewport
      canvas.style.position = "fixed";
      canvas.style.left = "0";
      canvas.style.top = "0";
      canvas.style.width = "100vw";
      canvas.style.height = "100vh";
      canvas.style.maxWidth = "none";
      canvas.style.maxHeight = "none";
      canvas.style.margin = "0";
    }
  } else {
    // Thoát fullscreen: trở về layout responsive (CSS của bạn sẽ áp dụng)
    canvas.style.position = "";
    canvas.style.left = "";
    canvas.style.top = "";
    canvas.style.maxWidth = "";
    canvas.style.maxHeight = "";
    canvas.style.margin = "";

    if (mobile) {
      // 90% của container: dùng % để dựa vào kích thước .game-container
      canvas.style.width = "90%";
      canvas.style.height = "auto"; // chiều cao do CSS hoặc aspect-ratio / calc xử lý
    } else {
      // desktop fixed preview size
      canvas.style.width = "486px";
      canvas.style.height = "864px";
    }
  }

  // luôn enforce logical internal size (không để ai chỉnh)
  enforceLogicalCanvasSize();
}

/* resize handler gọi khi load / fullscreen change / resize / orientation */
function resizeCanvasHandler() {
  // nhỏ delay để đảm bảo layout ổn định trên mobile
  setTimeout(() => {
    applyDisplaySizeForState();
    // enforce lại logical size sau khi layout ổn định
    enforceLogicalCanvasSize();
  }, 100);
}

/* ----- CHUYỂN TOẠ ĐỘ CHO INPUT ----- */
/* Luôn map client -> game logical (LOGICAL_WIDTH/HEIGHT) */
function getCanvasCoords(evt) {
  const rect = canvas.getBoundingClientRect();
  // rect.width/height là kích thước hiển thị CSS (px)
  const scaleX = LOGICAL_WIDTH / rect.width;
  const scaleY = LOGICAL_HEIGHT / rect.height;

  let clientX, clientY;
  if (evt.touches && evt.touches.length > 0) {
    clientX = evt.touches[0].clientX;
    clientY = evt.touches[0].clientY;
  } else {
    clientX = evt.clientX;
    clientY = evt.clientY;
  }

  const x = (clientX - rect.left) * scaleX;
  const y = (clientY - rect.top) * scaleY;
  return { x, y };
}

/* ----- Event forwarding tới TeaVM (gameTouchStart/Move/End) ----- */
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  const p = getCanvasCoords(e);
  if (typeof gameTouchStart === "function") gameTouchStart(p.x, p.y);
});
canvas.addEventListener("touchmove", e => {
  e.preventDefault();
  const p = getCanvasCoords(e);
  if (typeof gameTouchMove === "function") gameTouchMove(p.x, p.y);
});
canvas.addEventListener("touchend", e => {
  e.preventDefault();
  if (typeof gameTouchEnd === "function") gameTouchEnd();
});
canvas.addEventListener("mousedown", e => {
  const p = getCanvasCoords(e);
  if (typeof gameTouchStart === "function") gameTouchStart(p.x, p.y);
});
canvas.addEventListener("mouseup", e => {
  if (typeof gameTouchEnd === "function") gameTouchEnd();
});

/* Fullscreen button */
fullBtn.addEventListener("click", async () => {
  try {
    // trên mobile, dùng document.documentElement.requestFullscreen() nếu canvas.requestFullscreen gây lỗi
    const target = canvas.requestFullscreen ? canvas : document.documentElement;
    if (target.requestFullscreen) await target.requestFullscreen();
    else if (target.webkitRequestFullscreen) await target.webkitRequestFullscreen();
    else if (target.msRequestFullscreen) await target.msRequestFullscreen();
  } catch (err) {
    console.error("Request fullscreen failed:", err);
  }
});

/* Lắng nghe thay đổi */
document.addEventListener("fullscreenchange", resizeCanvasHandler);
window.addEventListener("resize", resizeCanvasHandler);
window.addEventListener("orientationchange", resizeCanvasHandler);

// Khi visualViewport thay đổi (di động), cập nhật
if (window.visualViewport) {
  window.visualViewport.addEventListener("resize", resizeCanvasHandler);
  window.visualViewport.addEventListener("scroll", resizeCanvasHandler);
}

/* Khởi tạo khi load */
window.addEventListener("load", () => {
  // đảm bảo internal size ban đầu
  enforceLogicalCanvasSize();
  // áp CSS hiển thị ban đầu phù hợp (desktop/mobile)
  applyDisplaySizeForState();

  // nếu TeaVM (app.js) thay đổi canvas.width/height sau khi load,
  // gọi enforceLogicalCanvasSize() thêm 1 lần sau 300ms để override
  setTimeout(enforceLogicalCanvasSize, 300);
});
</script>


</body>
</html>